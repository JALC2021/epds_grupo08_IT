<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>p6_epd09</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <script type="text/javascript" src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
        <script type="text/javascript">
            $(document).ready(function () {
                var xhttp = new XMLHttpRequest();
                //OPERACIÓN -->GET<--
                xhttp.open("GET", "http://localhost:8080/p7_epd08/webresources/bbdd.pelicula", true);
                xhttp.setRequestHeader("Accept", "application/xml");
                xhttp.onreadystatechange = function () {
                    if (xhttp.readyState === 4 && xhttp.status === 200) {
                        var rawXML = xhttp.responseXML;
                        // busca la etiqueta película
                        var xmlRow = $(rawXML).find('pelicula');
                        // va recorriendo cada una
                        $(xmlRow).each(function () {

                            var fechaEstrenoBBDD = $(this).find('fechaEstreno').text();
                            var fechaEstrenoBBDDFormateada = new Date(fechaEstrenoBBDD);
                            var fechaEstreno = fechaEstrenoBBDDFormateada.toLocaleDateString();
                            var fechaVideoBBDD = $(this).find('fechaVideo').text();
                            var fechaVideoBBDDFormateada = new Date(fechaVideoBBDD);
                            var fechaVideo = fechaVideoBBDDFormateada.toLocaleDateString();
                            $('#tablaPeliculas').append('<tr>'
                                    + '<td>' + $(this).find('id').text() + '</td>'
                                    + '<td>' + $(this).find('nombre').text() + '</td>'
                                    + '<td>' + fechaEstreno + '</td>'
                                    + '<td>' + fechaVideo + '</td>'
                                    + '<td>' + $(this).find('idioma').text() + '</td>'
                                    + '<td>' + $(this).find('pais').text() + '</td>'

                                    + '<td>'
                                    + '<form id="delete" name="delete" action="#" method="post">'
                                    + '<input type="submit" id="id" name="delete" value="DELETE" />'
                                    + '</form>'
                                    + '</td>'

                                    + '<td>'
                                    + '<form id="put" name="put" action="#" method="post">'
                                    + '<input type="submit" id="id" name="put" value="PUT" /></form>'
                                    + '</form>'
                                    + '</td>'
                                    + '</tr>');
                        });

                        if ($("input[name=delete]").click(function () {
                            alert("delete");
                        })) {
                        }

                        if ($("input[name=put]").click(function () {
                            alert("put");
                        })) {
                        }





                        //            var data = eval(xhttp.responseText);
                        //            for (var i in data) {
                        //                var row = $("<tr>");
                        //                for (var attr in data[i]) {
                        //            $(row).append($("<td>").append(data[i][attr])); } 
                        //        $("#data").append(row); 
                        //        $("#status").text("Datos cargados"); } };
                    }

                };
                xhttp.send();
            });


        </script>
    </head>

    <body>
        <h1>Lista de Peliculas</h1>

        <table id="tablaPeliculas" border="2">

            <tr>
                <th>ID</th>
                <th>NOMBRE</th>  
                <th>FECHA ESTRENO</th>  
                <th>FECHA V&Iacute;DEO</th>
                <th>IDIOMA</th>
                <th>PA&Iacute;S</th>
                <th>
                    <form action="" method="post">

                        <input type="submit" name="post" value="POST">

                    </form>
                </th>
            </tr>


    </body>
</html>
